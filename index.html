<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Kepala Sekolah Simulator</title>
<style>
body {
  margin: 0;
  background: #222;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
}
canvas {
  image-rendering: pixelated;
  border: 4px solid #4caf50;
}
#dialog {
  position: absolute;
  bottom: 80px;
  width: 600px;
  background: rgba(0,0,0,0.85);
  color: white;
  padding: 12px;
  font-family: monospace;
  display: none;
  border: 3px solid #4caf50;
}
#choices {
  position: absolute;
  bottom: 20px;
  width: 600px;
  display: none;
}
#choices button {
  margin: 5px;
  padding: 8px 12px;
  font-family: monospace;
  cursor: pointer;
}
#hud {
  position: absolute;
  top: 10px;
  left: 10px;
  color: white;
  font-family: monospace;
}
</style>
</head>
<body>
<canvas id="game" width="640" height="480"></canvas>
<div id="hud"></div>
<div id="dialog">
  <p id="dialogText"></p>
  <small>Tekan E untuk menutup</small>
</div>
<div id="choices">
  <button id="choice1"></button>
  <button id="choice2"></button>
  <button id="choice3"></button>
</div>
<script>
/* ===== SETUP ===== */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const tileSize = 32;
const cols = 20;
const rows = 15;

/* ===== MAP ===== */
// 0=rumput,1=kelas,2=kantin,3=lapangan
const map = [
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,1,1,1,0,0,0,2,2,2,0,0,0,3,3,3,0,0,0,0],
[0,1,1,1,0,0,0,2,2,2,0,0,0,3,3,3,0,0,0,0],
[0,1,1,1,0,0,0,0,0,0,0,0,0,3,3,3,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
];

/* ===== PLAYER SPRITE ===== */
const player = { x:5, y:5, color:"#ffeb3b", frame:0 };

/* ===== NPC SPRITE ===== */
const npcs = [
{x:8, y:5, color:"#2196f3", text:"Guru", frame:0},
{x:12, y:7, color:"#e91e63", text:"Siswi", frame:0},
{x:6, y:10, color:"#9c27b0", text:"Siswa", frame:0}
];

let activeDialog = null;
let step=0;
let env=50, money=50, happy=50;

/* ===== EVENTS 10 pertanyaan ===== */
const events = [
{q:"Sekolah ingin mengurangi sampah plastik. Apa yang dilakukan?", a1:"Larangan plastik total", e1:[15,-10,-5], a2:"Kurangi sebagian", e2:[8,-5,0], a3:"Tidak peduli", e3:[-15,0,-5]},
{q:"Tagihan listrik meningkat. Apa solusi?", a1:"Ganti semua lampu ke LED", e1:[10,-15,0], a2:"Matikan lampu saat tidak dipakai", e2:[5,0,0], a3:"Biarkan saja", e3:[-10,0,-5]},
{q:"Kantin mengeluh soal sampah plastik. Pilihanmu?", a1:"Kantin bebas plastik", e1:[10,-5,10], a2:"Gunakan plastik ramah lingkungan", e2:[5,-2,5], a3:"Tidak ada perubahan", e3:[-5,0,-5]},
{q:"Guru meminta tambahan dana kegiatan, setuju?", a1:"Setuju", e1:[0,-10,10], a2:"Setengah", e2:[0,-5,5], a3:"Tolak", e3:[0,0,-5]},
{q:"Peraturan baru: seragam ramah lingkungan, apa langkahmu?", a1:"Terapkan penuh", e1:[10,-10,5], a2:"Sebagian", e2:[5,-5,2], a3:"Tidak diterapkan", e3:[-5,0,-2]},
{q:"Lapangan sekolah kotor, apa tindakanmu?", a1:"Kerja bakti seluruh siswa", e1:[10,0,5], a2:"Petugas kebersihan tambahan", e2:[5,-5,2], a3:"Abaikan", e3:[-10,0,-5]},
{q:"Dana beasiswa terbatas, bagaimana strategi?", a1:"Kurangi biaya lain", e1:[0,-10,10], a2:"Kurangi sebagian siswa", e2:[0,-5,5], a3:"Tidak ada beasiswa", e3:[0,0,-10]},
{q:"Kantin ingin menjual makanan sehat, setuju?", a1:"Ya", e1:[10,-5,10], a2:"Sebagian", e2:[5,0,5], a3:"Tidak", e3:[-5,0,-5]},
{q:"Siswa meminta WiFi gratis, beri izin?", a1:"Ya", e1:[5,-5,10], a2:"Sebagian waktu", e2:[2,-2,5], a3:"Tidak", e3:[-5,0,-5]},
{q:"Sekolah ingin membuat taman baru, setuju?", a1:"Ya", e1:[10,-15,10], a2:"Sebagian", e2:[5,-5,5], a3:"Tidak", e3:[-5,0,-5]}
];

/* ===== INPUT ===== */
const keys = {};
window.addEventListener("keydown", e => keys[e.key]=true);
window.addEventListener("keyup", e => keys[e.key]=false);

/* ===== HUD ===== */
const hud = document.getElementById("hud");
function drawHUD(){
  hud.innerText = `Lingkungan: ${env}  Dana: ${money}  Kebahagiaan: ${happy}`;
}

/* ===== CHECK NPC ===== */
function checkNPC(){
  activeDialog = null;
  npcs.forEach(npc =>{
    if(Math.abs(player.x - npc.x)<=1 && Math.abs(player.y - npc.y)<=1){
      activeDialog = npc;
    }
  });
}

/* ===== DIALOG & PILIHAN ===== */
const dialogBox = document.getElementById("dialog");
const dialogText = document.getElementById("dialogText");
const choicesBox = document.getElementById("choices");

function showChoices(){
  if(step>=events.length){
    choicesBox.style.display="none";
    dialogBox.style.display="none";
    alert(`Game selesai!\nLingkungan: ${env}\nDana: ${money}\nKebahagiaan: ${happy}`);
    return;
  }
  dialogBox.style.display="block";
  dialogText.innerText = events[step].q;
  choicesBox.style.display="block";
  document.getElementById("choice1").innerText=events[step].a1;
  document.getElementById("choice2").innerText=events[step].a2;
  document.getElementById("choice3").innerText=events[step].a3;
}

function choose(opt){
  let effect;
  if(opt===1) effect=events[step].e1;
  if(opt===2) effect=events[step].e2;
  if(opt===3) effect=events[step].e3;
  env+=effect[0]; money+=effect[1]; happy+=effect[2];
  step++;
  showChoices();
}

document.getElementById("choice1").onclick=()=>choose(1);
document.getElementById("choice2").onclick=()=>choose(2);
document.getElementById("choice3").onclick=()=>choose(3);

window.addEventListener("keydown", e => {
  if(e.key==="e" && dialogBox.style.display==="block"){
    dialogBox.style.display="none";
    choicesBox.style.display="none";
  }
});

/* ===== UPDATE ===== */
function update(){
  if(keys["ArrowUp"]||keys["w"]) player.y--;
  if(keys["ArrowDown"]||keys["s"]) player.y++;
  if(keys["ArrowLeft"]||keys["a"]) player.x--;
  if(keys["ArrowRight"]||keys["d"]) player.x++;
  player.x=Math.max(0,Math.min(cols-1,player.x));
  player.y=Math.max(0,Math.min(rows-1,player.y));
  checkNPC();
  if(activeDialog && step<events.length){ showChoices(); }
}

/* ===== DRAW MAP ===== */
function drawMap(){
  for(let y=0;y<rows;y++){
    for(let x=0;x<cols;x++){
      if(map[y][x]===0) ctx.fillStyle="#4caf50";
      if(map[y][x]===1) ctx.fillStyle="#90a4ae";
      if(map[y][x]===2) ctx.fillStyle="#ffcc80";
      if(map[y][x]===3) ctx.fillStyle="#81c784";
      ctx.fillRect(x*tileSize,y*tileSize,tileSize,tileSize);
    }
  }
}

/* ===== DRAW PLAYER & NPC SPRITE ===== */
function drawPlayer(){
  ctx.fillStyle=player.color;
  ctx.fillRect(player.x*tileSize+6,player.y*tileSize+6,20,20);
}
function drawNPCs(){
  npcs.forEach(npc=>{
    ctx.fillStyle=npc.color;
    ctx.fillRect(npc.x*tileSize+6,npc.y*tileSize+6,20,20);
  });
}

/* ===== GAME LOOP ===== */
function gameLoop(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  update();
  drawMap();
  drawNPCs();
  drawPlayer();
  drawHUD();
  requestAnimationFrame(gameLoop);
}
gameLoop();
</script>
</body>
</html>





